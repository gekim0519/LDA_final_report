---
title: "logitudinal_final_proj"
author: "Lynette Pan"
date: "12/3/2018"
output: pdf_document
---

#Final Project: Smoking in the Framingham Heart Study


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(janitor)
frmgham = 
  read.csv2("frmgham2.csv", sep = ",") %>% 
  clean_names() %>% select(cursmoke, everything()) %>% 
  mutate(sex = as.factor(sex),
         bpmeds = as.factor(bpmeds),
         cursmoke = as.factor(cursmoke),
         educ = as.factor(educ),
         diabetes = as.factor(diabetes),
         prevap = as.factor(prevap),
         prevchd = as.factor(prevchd),
         prevmi = as.factor(prevmi),
         prevstrk = as.factor(prevstrk),
         prevhyp = as.factor(prevhyp)) %>% 
  as.tibble()
```

#missing values
```{r}
frmgham %>% 
  group_by(period) %>% 
  summarize(sum_na_period = sum(is.na(period)))

d1 = frmgham %>% 
  group_by(randid) %>% 
  summarize(n = n())
table(d1$n)
# 447 patients have only one obs
#781 patients have only two obs
#3206 patients have all three obs

number.subjects <- 
  frmgham  %>% 
  select(randid) %>% 
  distinct() %>% 
  unlist() %>%
  length()

number.subjects
```

* there are 447 patients who have only one obs; there are 781 patients who have only two obs and 3206 patients have all three obs. In total, there are 4434 patients in the study.

##1. Target question:
1) Is there a relationship between age and smoking status?  Does this relationship differ by sex? 

* In general, an increase in age seems to results in a decrease in current smoking status. However, the age where it has the highest probability of being a smoker is around 40.



```{r}
frmgham %>% 
  ggplot(., aes(x=age, y=cursmoke)) +
    geom_jitter() + 
    geom_smooth(method = "loess") +ggtitle("Unadjusted relationship between age and smoking status")
```


```{r}
frmgham %>% 
  mutate(sex=ifelse(sex==1, "male","women")) %>% 
  ggplot(., aes(x=age, y=cursmoke)) +
    geom_jitter() + 
    geom_smooth(method = "loess") +
  facet_grid(~sex)+
  ggtitle("Relationship between age and smoking status by gender")
```
* In general, an increase in age seems to results in a decrease in current smoking status for both gender group.

## created age category
```{r}
frmgham =
  frmgham %>% 
  mutate(
      age_ctg = case_when(
      age %in% 35:44 ~ "35-44",
      age %in% 45:54 ~ "45-54",
      age %in% 55:64 ~ "55-64",
      age %in% 65:74 ~ "65-74",
      age >= 75 ~ "75+"
    )) 
```





(2) Is there a relationship between the number of cigarettes smoked per day and age?  Does this relationship differ by sex? 

While answering these questions, please account for any confounders that you have evidence may impact the relationship between age and sex with smoking.

```{r}
frmgham %>% 
  ggplot(., aes(x=age, y=cigpday)) +
    geom_jitter() + 
    geom_smooth(method = "loess") +
  ggtitle("Unadjusted relationship between the number of cigarettes smoked per day and age")
```

```{r}
confounder <- function(model) {
      model.sum <- summary(model)
      model.b <- model.sum$coefficients[2, 1]
      oldmodel <- update(model, . ~ . -x)
      oldmodel.sum <- summary(oldmodel)
      oldmodel.b <- oldmodel.sum$coefficients[2, 1]
      model.frame <- tidy(model.sum)
      model.sub <- subset(model.frame, term = "x")
      model.sub.b <- model.sub[, 5]
      if ((model.b - oldmodel.b)/model.b >= .1 |
           model.sub.b < .05)
        return(model.sum)
}

    lapply(Covariates, function(x) {
      confounder(glm(Outcome ~, family = binomial(link=logit)))
    })
```


```{r}
frmgham %>% 
  mutate(sex=ifelse(sex==1, "male","women")) %>% 
  ggplot(., aes(x=age, y=cigpday)) +
  geom_jitter() + 
  geom_smooth(method = "loess") +
  facet_grid(~sex)+
  ggtitle("Relationship between the number of cigarettes smoked per day and age by gender")
```




#2.Target question:

Next you are interested in the relationship between certain health outcomes and smoking status.  In particular you are interested in :


(1)The relationship between current smoking status and systolic blood pressure.


(2)The relationship between current smoking status and diastolic blood pressure.


(3)The relationship between current smoking status and serum total cholesterol.   Again, while answering these questions, please account for any confounders that you have evidence may impact these relationships. 
